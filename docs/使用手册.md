# 使用手册

## 项目部署地址

项目已经部署在公网服务器上，部署地址：

- 前端：[启真智选](http://101.34.242.157:20001/#/)
- 后端：[101.34.242.157:8000](http://101.34.242.157:8000/)

## 部署方式

需要宿主机为 linux 并且具有 docker, mysql 环境，并且打开 `:20001` （前端）和 `:8000` （后端） 端口的防火墙端口。最好还要有通畅的网络，能连上 docker 和 playwright 的下载网站。

### 前端部署

需要将 `frontend/src/utils.ts` 中的 `prefix` 改为您部署的后端的地址，例如：

```ts
const prefix: string = "http://101.34.242.157:8000";
```

然后运行

```shell
cd frontend
docker compose up -d --build
```

即可部署完成。

### 后端部署

编辑后端的配置文件 `backend/config.toml` 

修改 `database.database_url` 为宿主机的 mysql url，修改 `cors.allow_origins` 为您部署的前端地址，其他部分可以不用修改，例如：

```toml
[email]
sender_email = "******@163.com"
sender_password = "******"
smtp_server = "smtp.163.com"
smtp_port = 465

[cors] 
allow_origins = ['http://localhost:5173', 'http://localhost:20001', 'http://101.34.242.157:20001']

[jwt]
secret_key = 'secret_key'

[database]
database_url = 'mysql+aiomysql://root:root@localhost:3307/bs'

[openai]
api_key = "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
```

## 使用说明

首页包含搜索栏，登录按钮 和 注册按钮。

不注册也可以搜索，不过为了更完善的用户功能体验，我们先注册。

![image-20241225145933429](assets/image-20241225145933429.png)

点击注册按钮，进入注册页面，输入 电子邮箱/用户名/密码 进行注册。

电子邮箱字段需要符合电子邮箱的格式，用户名和密码都至少需要包含 6 个字符。后端会验证这些字段是否合法。

![image-20241225150940745](assets/image-20241225150940745.png)

注册完成后，会跳转到登录界面，输入刚才注册的电子邮箱和密码即可登录。

我是用 JWT 来鉴权，登录后对应 cookie 字段会被设为 jwt token，用于让服务器识别已经登录的用户。

![image-20241225151024168](assets/image-20241225151024168.png)

登录成功后，网站会自动跳转到首页。注意到，此时导航栏的两个按钮已经变成了 “我的订阅” 和 “登出”，表示此时我们为已经登录的状态。

![image-20241225151043346](assets/image-20241225151043346.png)

在搜索栏中输入 搜索词，并点击 “搜索” 按钮即可进行搜索。

搜索时，启真智选的 AI 将会自动给出该类商品的购买建议。

同时，后端会抓取对应商品数据，分批返回前端。

商品信息 和 AI 智选建议 都使用 了 流式响应，相比于爬取完整数据后返回（20s+），可以显著提高用户体验。

![image-20241225151147120](assets/image-20241225151147120.png)

![image-20241225151119826](assets/image-20241225151119826.png)

点击搜索结果的商品卡片，可以进入 商品详情页。

在商品详情页中，可以订阅商品，订阅后，启真智选 将会 每日为您检查 商品是否有新的价格，如果有，会发邮件提醒您。

点击 “链接直达” 按钮会跳转到 对应平台的商品购买页面。

![image-20241225151222209](assets/image-20241225151222209.png)

商品详情页还包含 历史价格折线图 和 历史价格。（价格包括相似商品）

历史价格折线图 以 时间为 横轴，以 价格 为 纵轴 建立，将会有助于您判断目前价格在历史中所处的方位，避免背刺。

历史价格为折线图的对应得点的表格，点击表格中的商品编号可以跳转到对应商品的详情页。

![image-20241225151305056](assets/image-20241225151305056.png)

订阅后 原 “去订阅” 按钮会变成 “取消订阅”，点击 “取消订阅” 按钮可以取消订阅。

![image-20241225151321021](assets/image-20241225151321021.png)

点击导航栏上的 "我的订阅" 按钮会跳转到 订阅页面。

您订阅的商品会出现在订阅页面。

点击 “发送降价提醒邮件” 按钮可以手动强制地检查一次价格，并发送邮件。（不用点击此按钮也会每日自动检查价格）

点击 “商品详情页” 按钮 可以 跳转到 对应商品 的 商品详情页。

![image-20241225151347865](assets/image-20241225151347865.png)

图为 点击 “发送降价提醒邮件” 按钮 后 收到的邮件。

![image-20241225151417055](assets/image-20241225151417055.png)
